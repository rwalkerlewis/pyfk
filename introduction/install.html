
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Installing &#8212; PyFK 0.3.1 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="PyFK" href="../index.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">PyFK 0.3.1 documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Installing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="tutorial.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../parallel/parallel.html">
  Parallelization
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../benchmark/benchmark.html">
  Benchmark
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gallery/gallery.html">
  Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../autoapi/index.html">
  API Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-the-pyfk-package">
   Install the PyFK package
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-installation">
     General Installation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mpi-mode">
     MPI Mode
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpu-mode">
     GPU mode
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-the-installation">
   Test the Installation
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="installing">
<span id="install"></span><h1>Installing<a class="headerlink" href="#installing" title="Permalink to this heading">#</a></h1>
<section id="install-the-pyfk-package">
<h2>Install the PyFK package<a class="headerlink" href="#install-the-pyfk-package" title="Permalink to this heading">#</a></h2>
<p>The supported Python versions include 3.7, 3.8, and 3.9. Python 2 is not supported. Versions prior (include) 3.6 are not supported. Versions after (include) 3.10 are not supported as the Cython compatible issue.</p>
<p>Currently, the package is only supported on Unix-like systems, including Mac and Linux. Windows is not supported as VS compiler doesn’t support the C99 standard of “complex.h”, which is used in the package. Other platforms such as Mac OS with M1 chip might be supported through installing from PyPi or the source, but it has not been tested.</p>
<section id="general-installation">
<h3>General Installation<a class="headerlink" href="#general-installation" title="Permalink to this heading">#</a></h3>
<p>To install the package on serial mode and the GPU parallel mode, you can install from PyPi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyfk</span>
</pre></div>
</div>
<p>Note this command might fail in some rare cases if mpi4py can not be installed in the local system. You may have to install openmpi or mpich, or try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">poetry</span><span class="o">-</span><span class="n">core</span><span class="nd">@https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">poetry</span><span class="o">/</span><span class="n">poetry</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">refs</span><span class="o">/</span><span class="n">tags</span><span class="o">/</span><span class="mf">1.1.0</span><span class="n">a7</span><span class="o">.</span><span class="n">zip</span>
<span class="c1"># or any version later than 1.1.0a7, or just poetry-core when poetry 1.1.0 has been released</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">obspy</span> <span class="n">cython</span> <span class="n">scipy</span> <span class="n">cysignals</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pyfk</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">isolation</span>
</pre></div>
</div>
<p>Anaconda environment is also supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">ziyixi</span> <span class="n">pyfk</span>
</pre></div>
</div>
</section>
<section id="mpi-mode">
<h3>MPI Mode<a class="headerlink" href="#mpi-mode" title="Permalink to this heading">#</a></h3>
<p>To install the package with the MPI mode, you can install it from PyPi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PYFK_USE_MPI</span><span class="o">=</span><span class="mi">1</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pyfk</span><span class="p">[</span><span class="n">mpi</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">PYFK_USE_MPI</span></code> is a environment variable that should be set to 1 to enable the MPI mode. This environment is only required in installation. The package with the MPI supporting can fully replace the package in normal mode by providing extra features in running the code in parallel (with mpirun).</p>
<p>Note a working MPI C compile is required for compilation. Conda is not supported for MPI mode, as the MPI is system dependent, especially for the case in the super computers.</p>
<p>If you have installed mpi4py using conda before, it is advised to reinstall it using PyPi or uninstall it. Conda will attempt to install its own version of MPI, which usually works fine for a single node. But in the case of super computers, it might conflict with commands like “srun” or “ibrun”.</p>
<p>If you install the MPI mode after installing the normal mode, you need to reinstall the package without any cached wheels using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PYFK_USE_MPI</span><span class="o">=</span><span class="mi">1</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pyfk</span><span class="p">[</span><span class="n">mpi</span><span class="p">]</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="nb">dir</span>
</pre></div>
</div>
</section>
<section id="gpu-mode">
<h3>GPU mode<a class="headerlink" href="#gpu-mode" title="Permalink to this heading">#</a></h3>
<p>Apart from the general Installation, there are some other packages that need to be installed. It’s suggested to use Anaconda to download these packages to better incorporate with the CUDA toolkits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">cupy</span> <span class="n">numba</span>
</pre></div>
</div>
<p>Special note to check the GPU driver version and the CUDA version using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</pre></div>
</div>
<p>As the version for cudatoolkit should be equal or smaller than the driver’s supported version. Higher versions might have the risk of the CUDA runtime error. For example, on the local cluster on MSU ICER, the supported CUDA version is 11.5, while using the above conda command will install the CUDA 11.6 toolkit at the time of April 2022. So instead, for this case, we can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">cupy</span> <span class="n">numba</span> <span class="n">cudatoolkit</span><span class="o">=</span><span class="mf">11.5</span>
</pre></div>
</div>
<p>Using PyPi to install these two packages is also possible, you can refer to the document of <a class="reference external" href="https://docs.cupy.dev/en/stable/install.html">CuPy</a> and <a class="reference external" href="https://numba.pydata.org/numba-doc/latest/user/installing.html#installing-using-pip-on-x86-x86-64-platforms">Numba</a>. Note these two packages should be installed with the CUDA support.</p>
<p>These two packages can be installed before or after installation PyFK, either in the normal mode or the MPI mode. There is nothing special for installing PyFK in the GPU mode.</p>
</section>
</section>
<section id="test-the-installation">
<h2>Test the Installation<a class="headerlink" href="#test-the-installation" title="Permalink to this heading">#</a></h2>
<p>To test the installation of the package, you can import the package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyfk</span>
<span class="n">pyfk</span><span class="o">.</span><span class="n">mpi_info</span><span class="p">()</span>
</pre></div>
</div>
<p>If MPI mode is enabled, it will output the MPI related information. If not, it will output “MPI is not used.”.</p>
<p>To have a complete test of PyFK, several other packages should be downloaded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">mpi</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">mpi</span>
</pre></div>
</div>
<p>After installing the packages, you can run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="n">pyargs</span> <span class="n">pyfk</span>
</pre></div>
</div>
<p>Several warnings can be omitted, such as dividing a zero, which is only related to cross-correlate two waveforms with all values as 0.</p>
<p>To test the GPU mode, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PYFK_USE_CUDA</span><span class="o">=</span><span class="mi">1</span> <span class="n">pytest</span> <span class="o">--</span><span class="n">pyargs</span> <span class="n">pyfk</span>
</pre></div>
</div>
<p>To test the MPU version, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">3</span> <span class="n">pytest</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">mpi</span> <span class="o">--</span><span class="n">pyargs</span> <span class="n">pyfk</span>
</pre></div>
</div>
<p>for three processes’ parallation.</p>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../index.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">PyFK</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="tutorial.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Tutorial</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2020-2022, Ziyi Xi.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>